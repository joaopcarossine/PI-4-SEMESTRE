
{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Listar Inst√¢ncias de Fluxo</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@100..800&display=swap');
    </style>
    
</head>
<body>


    {% include 'sidebar.html' %}
    <div class="main-content">

    <h1> <img class="main-img" src="\static\img\flow.png"> Inst√¢ncias de Fluxo</h1>

    

    <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'andamento')"> Andamento</button>
        <button class="tablinks" onclick="openTab(event, 'finalizado')"> Finalizados</button>


          <input type="text" id="pesquisa-universal" class="input-pesquisa" placeholder="üîçÔ∏é Pesquisar..." onkeyup="filtrarUniversal()">

        <a class="right-top-button" href="{% url 'criar_instancia_fluxo' %}"> <img style="width: 17px;height: 17px; padding-right:10px;" src="\static\img\add.png"> Adicionar</a>
    </div>

   

    <!-- ABA 1: Em andamento -->
    <div id="andamento" class="tabcontent" style="display:block;">
        {% if em_andamento %}
        
        <table>

            <tr>
                <th>Nome</th>
                <th>Modelo</th>
                <th>Status</th>
                <th>Criado em</th>
                <th>A√ß√µes</th>
            </tr>
            {% for instancia in em_andamento %}
            <tr>
                <td>{{ instancia.nome }}</td>
                <td>{{ instancia.modelo.nome }}</td>
                <td>Pendente</td>
                <td>{{ instancia.criado_em|date:"d/m/Y H:i" }}</td>
                <td>

                    <a class="a-detalhes" href="{% url 'detalhar_instancia_fluxo' instancia.id %}"> <img src="\static\img\eye.png">Detalhes </a>

                    <a class="a-excluir" href="{% url 'excluir_instancias_fluxo' instancia.id %}"> <img src="\static\img\trash.png">Excluir </a>

                </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
            <p>Nenhum fluxo em andamento.</p>
        {% endif %}
    </div>

    <!-- ABA 2: Finalizados -->
    <div id="finalizado" class="tabcontent">
        {% if finalizados %}
        <table>
            <tr>
                <th>Nome</th>
                <th>Modelo</th>
                <th>Status</th>
                <th>Finalizado em</th>
                <th>A√ß√µes</th>
            </tr>
            {% for instancia in finalizados %}
            <tr>
                <td>{{ instancia.nome }}</td>
                <td>{{ instancia.modelo.nome }}</td>
                <td>Finalizado</td>
                <td>{{ instancia.atualizado_em|date:"d/m/Y H:i" }}</td>
                <td>

                    <a class="a-detalhes" href="{% url 'detalhar_instancia_fluxo' instancia.id %}"> <img src="\static\img\eye.png"> Detalhes</a>

                    <a class="a-excluir" href="{% url 'excluir_instancias_fluxo' instancia.id %}"> <img src="\static\img\trash.png"> Excluir</a>
                    
                </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
            <p>Nenhum fluxo finalizado.</p>
        {% endif %}
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.classList.add("active");
        }

        function filtrarUniversal() {
    let filtro = document.getElementById("pesquisa-universal").value.toLowerCase();

    // pega a aba ativa
    let ativa = document.querySelector(".tablinks.active").innerText.trim().toLowerCase();

    let tabelaId = ativa === "andamento" ? "andamento" : "finalizado";
    let tabela = document.querySelector(`#${tabelaId} table`);

    if (!tabela) return;

    let linhas = tabela.getElementsByTagName("tr");

    for (let i = 1; i < linhas.length; i++) {
        let colunas = linhas[i].getElementsByTagName("td");
        let textoLinha = "";

        for (let c = 0; c < colunas.length; c++) {
            textoLinha += colunas[c].innerText.toLowerCase() + " ";
        }

        linhas[i].style.display = textoLinha.includes(filtro) ? "" : "none";
    }
}

    </script>
</div>
</body>
</html>
